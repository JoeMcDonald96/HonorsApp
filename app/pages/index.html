<html>
  <head>
    <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
    <script src="https://rawgit.com/mayognaise/aframe-mouse-cursor-component/master/dist/aframe-mouse-cursor-component.min.js"></script>

    <!-- <script src="https://rawgit.com/rdub80/aframe-gui/master/dist/aframe-gui.min.js"></script> -->
    <script src='https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js'></script>
    <script src='https://surikov.github.io/webaudiofontdata/sound/0000_Aspirin_sf2_file.js'></script>
    <script>
      // Initialise webAudioFont
			var AudioContextFunc = window.AudioContext || window.webkitAudioContext;
			var audioContext = new AudioContextFunc();
			var player = new WebAudioFontPlayer();
			player.loader.decodeAfterLoading(audioContext, '_tone_0090_JCLive_sf2_file');

      var notes = {
        c4: 4*12+0, c_4: 4*12+1, d4: 4*12+2, c_4: 4*12+3, e4: 4*12+4, f4: 4*12+5,
        f_4: 4*12+6, g4: 4*12+7, g_4: 4*12+8, a4: 4*12+9, a_4: 4*12+10, b4: 4*12+11,
        c5: 5*12+0, c_5: 5*12+1, d5: 5*12+2, c_5: 5*12+3, e5: 5*12+4, f5: 5*12+5,
        f_5: 5*12+6, g5: 5*12+7, g_5: 5*12+8, a5: 5*12+9, a_5: 5*12+10, b5: 5*12+11
      };

      var chords = {
        cmaj : { r: notes.c4, t: notes.e4, f: notes.g4 },
        dmin : { r: notes.d4, t: notes.f4, f: notes.a4 },
        emin : { r: notes.e4, t: notes.g4, f: notes.b4 },
        fmaj : { r: notes.f4, t: notes.a4, f: notes.c5 },
        gmaj : { r: notes.g4, t: notes.b4, f: notes.d5 },
        bdim : { r: notes.b4, t: notes.d5, f: notes.f5 }
      };

      //
			function playKey(pitch){
				player.queueWaveTable(audioContext, audioContext.destination, _tone_0000_Aspirin_sf2_file, 0, pitch, 0.75);
			}

      function playChord(r, t, f) {
        playKey(r);
        playKey(t);
        playKey(f);
      }
    </script>
  </head>
  <body>
    <a-scene cursor="rayOrigin: mouse">

      <!-- <a-box position="0 0.5 -3" rotation="0 45 0" scale="0.5 0.5 0.5" color="#4CC3D9"></a-box> -->
      <!-- <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
      <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder> -->
      <a-entity>
      <a-plane position="0 0 -4" rotation="-90 0 0" width="20" height="20" color="#808080"></a-plane>
      <a-sky color="#ECECEC"></a-sky>

      <a-entity position="-3 3 -6" rotation="0 -135 0">
        <a-camera>
          <a-cursor color="#FF0000"/>
        </a-camera>
      </a-entity>
    </a-scene>

    <script>
      // Get the scene for adding elements to
      var scene = document.querySelector('a-scene');

      var iSize = 3;

      // Set offsets for object positions
      var xOffset = 0.6;
      var yOffset = 0.6;
      var zOffset = 0.6;

      // Loop, creating and adding blocks
      for(var i = 0; i < iSize; i++) {
        for(var j = 0; j < iSize; j++) {
          for(var k = 0; k < iSize; k++) {
            // Create/calculate instance specific attributes
            var id = "box_[" + i + "," + j + "," + k +"]";
            var x = 0 + (xOffset * i);
            var y = 0.5 + (yOffset * j);
            var z = -3 + (zOffset * k);

            // Create elements
            var box = document.createElement('a-box');
            var labelz = document.createElement('a-text');
            var labelx = document.createElement('a-text');

            // Identification attributes
            box.className = "chordBlocks";
            box.setAttribute("id", id);

            // A-frame element attributes
            box.setAttribute("position", {
              x: x,
              y: y,
              z: z
            });
            box.setAttribute("rotation","0 180 0");
            box.setAttribute("scale","0.5 0.5 0.5");
            box.setAttribute("color","#4CC3D9");

            labelz.setAttribute("value", id);
            labelz.setAttribute("position", {
              x: -0.6,
              y: 0,
              z: 0.5
            });
            labelz.setAttribute("wrap-count", 20);
            //label.setAttribute("rotation","0 90 0");
            labelx.setAttribute("value", id);
            labelx.setAttribute("position", {
              x: 0.5,
              y: 0,
              z: 0.5
            });
            labelx.setAttribute("rotation","0 90 0");

            box.appendChild(labelz);
            box.appendChild(labelx);

            // Add the block to the scene
            scene.appendChild(box);
          } // End z loop
        } // End y loop
      } // End x loop

      // Get all chordBlocks
      var allChordBlocks = document.getElementsByClassName("chordBlocks");

      // Mouse enter function
      var scaleEnterFunction = function() {
        this.setAttribute("scale", {
            x: 0.52,
            y: 0.52,
            z: 0.52
        });
        this.setAttribute("color", "#FF0000");
      };

      // Mouse leave function
      var scaleLeaveFunction = function() {
        this.setAttribute("scale", {
            x: 0.5,
            y: 0.5,
            z: 0.5
        });
        this.setAttribute("color","#4CC3D9");
      };

      // Mouse click function
      var blockClicked = function() {
        var bi = this.getAttribute("id");
        var r = chords.dmin.r;
        var t = chords.dmin.t;
        var f = chords.dmin.f;
        // this.setAttribute("clicked", "true");
        //playChord(notes.c4, notes.e4, notes.a4);
        //playKey(4*12+0);
        console.log("Block ID: " + bi);
        playChord(r, t, f);
      };

      // Loop adding events to all blocks
      for (var i = 0; i < allChordBlocks.length; i++) {
        allChordBlocks[i].addEventListener("mouseenter", scaleEnterFunction);
        allChordBlocks[i].addEventListener("mouseleave", scaleLeaveFunction);
        allChordBlocks[i].addEventListener("click", blockClicked);
      }
    </script>
  </body>
</html>
